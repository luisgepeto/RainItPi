@model List<RainIt.Domain.DTO.RoutineDTO>
<link href="~/Content/thumbnailscroller/jquery.mThumbnailScroller.css" rel="stylesheet" />
<script src="~/Scripts/thumbnailscroller/jquery.mThumbnailScroller.js"></script>
<style>
    .routine-holder{
  overflow: auto;
  width: 800px;
  height: auto;
}
</style>
<div class="container" style="margin-top: 50px;">
    <div class="row col-md-12">
        @foreach (var routine in Model)
        {
            <input type="checkbox" id="@("active_" + routine.RoutineId)" class="is-active-checkbox" checked="@routine.IsActive" />
            <div id="@("routine-holder" + routine.RoutineId)" class="routine-holder">
                <ul>
                    @foreach (var routinePattern in routine.RoutinePatternDTOs)
                    {
                        <li>
                            <a href="@Url.Action("Edit", "Routine", new {routineId = routine.RoutineId})">
                                <img src="@(routinePattern.PatternDTO.Path)"/>
                            </a>
                        </li>
                    }
                </ul>
            </div>
        }
    </div>
    @using (Html.BeginForm("Add", "Routine", FormMethod.Get))
    {
        <button name="addRoutine" value="addRoutine" id="addRoutineButton">Add Routine</button>
    }
</div>
<script type="text/javascript">
    (function() {
        this.RoutineIndexProperties = this.RoutineIndexProperties || {};

        var checkBox = (function () {
            var properties = {};
            function uncheckAllExcept(checkbox) {
                $('.is-active-checkbox').each(function (index) {
                    var currentCheckbox = $(this);
                    if (currentCheckbox.attr("id") != checkbox.attr("id")) {
                        currentCheckbox.prop('checked', false);
                    }
                });
            }
            
            function makeActiveAjaxCall(routineId) {
                $.ajax({
                    type: "POST",
                    url: '@Url.Action("SetActive", "Routine")',
                    data: { routineId: routineId }
                });
            }


            function addClickListener() {
                $('.is-active-checkbox').click(function (e) {
                    var currentCheckbox = $(this);
                    if (!currentCheckbox.is(":checked")) {
                        e.preventDefault();
                    } else {
                        uncheckAllExcept(currentCheckbox);
                        makeActiveAjaxCall(currentCheckbox.attr("id").split("_")[1]);
                    }
                });
            }
            properties.Initialize = function () {
                addClickListener();
            }
            return properties;
        }());

        var scroller = (function() {
            var properties = {};
            properties.Initialize = function() {
                $('.routine-holder').mThumbnailScroller({
                    axis: 'x'
                });
            }
            return properties;
        }());
        RoutineIndexProperties.SetupPage = function () {
            scroller.Initialize();
            checkBox.Initialize();
        }
    }());
    $(document).ready(function() {
        RoutineIndexProperties.SetupPage();
    });
</script>